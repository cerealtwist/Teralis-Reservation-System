<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Login | Teralis</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@700&family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

  <!-- Design System -->
  <link rel="stylesheet" href="assets/css/design-system.css">
  <link rel="stylesheet" href="assets/css/navbar.css">
  <link rel="stylesheet" href="assets/css/login.css">
</head>

<body>

<!-- NAVBAR (AUTH VERSION) -->
<nav class="navbar navbar-expand-lg navbar-auth fixed-top">
  <div class="container">
    <a class="navbar-brand d-flex align-items-center gap-2" href="index.html">
      <img
        src="../static/assets/icons/teralis-logo-red.svg"
        alt="Teralis Logo"
      >
    </a>

    <div class="collapse navbar-collapse justify-content-end">
      <ul class="navbar-nav nav-main me-4">
        <li class="nav-item">
          <a class="nav-link active" href="index.html">
            <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
              <g clip-path="url(#clip0_172_5562)">
              <path d="M9 2.25L3 6.75V15.75H6.75V10.5H11.25V15.75H15V6.75L9 2.25Z" fill="currentColor"/>
              </g>
              <defs>
              <clipPath id="clip0_172_5562">
              <rect width="18" height="18"/>
              </clipPath>
              </defs>
            </svg>
            <span>Home</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="room.html">
            <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
              <g clip-path="url(#clip0_172_5568)">
              <path d="M1 18C0.716667 18 0.479333 17.904 0.288 17.712C0.0960001 17.5207 0 17.2833 0 17C0 16.7167 0.0960001 16.4793 0.288 16.288C0.479333 16.096 0.716667 16 1 16H2V1C2 0.716667 2.09567 0.479 2.287 0.287C2.479 0.0956666 2.71667 0 3 0H10C10.2833 0 10.521 0.0956666 10.713 0.287C10.9043 0.479 11 0.716667 11 1H15C15.2833 1 15.5207 1.09567 15.712 1.287C15.904 1.479 16 1.71667 16 2V16H17C17.2833 16 17.5207 16.096 17.712 16.288C17.904 16.4793 18 16.7167 18 17C18 17.2833 17.904 17.5207 17.712 17.712C17.5207 17.904 17.2833 18 17 18H15C14.7167 18 14.4793 17.904 14.288 17.712C14.096 17.5207 14 17.2833 14 17V3H11V17C11 17.2833 10.9043 17.5207 10.713 17.712C10.521 17.904 10.2833 18 10 18H1ZM9 9C9 8.71667 8.90433 8.479 8.713 8.287C8.521 8.09567 8.28333 8 8 8C7.71667 8 7.47933 8.09567 7.288 8.287C7.096 8.479 7 8.71667 7 9C7 9.28333 7.096 9.52067 7.288 9.712C7.47933 9.904 7.71667 10 8 10C8.28333 10 8.521 9.904 8.713 9.712C8.90433 9.52067 9 9.28333 9 9Z" fill="currentColor"/>
              </g>
              <defs>
              <clipPath id="clip0_172_5568">
              <rect width="18" height="18"/>
              </clipPath>
              </defs>
            </svg>
            <span>Ruangan</span>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="guide.html">
            <svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M4.5 16.5C3.8625 16.5 3.32812 16.2844 2.89688 15.8531C2.46563 15.4219 2.25 14.8875 2.25 14.25V3.75C2.25 3.125 2.46563 2.59375 2.89688 2.15625C3.32812 1.71875 3.8625 1.5 4.5 1.5H11.25C11.6625 1.5 12.0156 1.64687 12.3094 1.94063C12.6031 2.23438 12.75 2.5875 12.75 3V12C12.75 12.4125 12.6031 12.7656 12.3094 13.0594C12.0156 13.3531 11.6625 13.5 11.25 13.5H4.5C4.2875 13.5 4.10938 13.5719 3.96563 13.7156C3.82188 13.8594 3.75 14.0375 3.75 14.25C3.75 14.4625 3.82188 14.6406 3.96563 14.7844C4.10938 14.9281 4.2875 15 4.5 15H14.25V3.75C14.25 3.5375 14.3219 3.35938 14.4656 3.21563C14.6094 3.07188 14.7875 3 15 3C15.2125 3 15.3906 3.07188 15.5344 3.21563C15.6781 3.35938 15.75 3.5375 15.75 3.75V15C15.75 15.4125 15.6031 15.7656 15.3094 16.0594C15.0156 16.3531 14.6625 16.5 14.25 16.5H4.5ZM6 12C6.2125 12 6.39062 11.9281 6.53438 11.7844C6.67813 11.6406 6.75 11.4625 6.75 11.25V3.75C6.75 3.5375 6.67813 3.35938 6.53438 3.21563C6.39062 3.07188 6.2125 3 6 3C5.7875 3 5.60938 3.07188 5.46563 3.21563C5.32188 3.35938 5.25 3.5375 5.25 3.75V11.25C5.25 11.4625 5.32188 11.6406 5.46563 11.7844C5.60938 11.9281 5.7875 12 6 12Z" fill="currentColor"/>
            </svg>
            <span>Petunjuk</span>
          </a>
        </li>
        <li class="nav-item" id="status-nav-item" style="display: none;">
          <a class="nav-link" href="status.html">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard2-fill" viewBox="0 0 16 16">
              <path d="M9.5 0a.5.5 0 0 1 .5.5.5.5 0 0 0 .5.5.5.5 0 0 1 .5.5V2a.5.5 0 0 1-.5.5h-5A.5.5 0 0 1 5 2v-.5a.5.5 0 0 1 .5-.5.5.5 0 0 0 .5-.5.5.5 0 0 1 .5-.5z"/>
              <path d="M3.5 1h.585A1.5 1.5 0 0 0 4 1.5V2a1.5 1.5 0 0 0 1.5 1.5h5A1.5 1.5 0 0 0 12 2v-.5q-.001-.264-.085-.5h.585A1.5 1.5 0 0 1 14 2.5v12a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 14.5v-12A1.5 1.5 0 0 1 3.5 1"/>
            </svg>
            <span>Status</span>
          </a>
        </li>
        <li class="nav-item" id="status-nav-item" style="display: none;">
          <a class="nav-link" href="status.html">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard2-fill" viewBox="0 0 16 16">
              <path d="M9.5 0a.5.5 0 0 1 .5.5.5.5 0 0 0 .5.5.5.5 0 0 1 .5.5V2a.5.5 0 0 1-.5.5h-5A.5.5 0 0 1 5 2v-.5a.5.5 0 0 1 .5-.5.5.5 0 0 0 .5-.5.5.5 0 0 1 .5-.5z"/>
              <path d="M3.5 1h.585A1.5 1.5 0 0 0 4 1.5V2a1.5 1.5 0 0 0 1.5 1.5h5A1.5 1.5 0 0 0 12 2v-.5q-.001-.264-.085-.5h.585A1.5 1.5 0 0 1 14 2.5v12a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 14.5v-12A1.5 1.5 0 0 1 3.5 1"/>
            </svg>
            <span>Status</span>
          </a>
        </li>
      </ul>

      <a href="login.html" id="login-nav-btn" class="btn-login" style="display: none;">Login</a>
      <a href="#" id="logout-nav-btn" class="btn-login" style="display: none;" onclick="handleLogout()">Logout</a>
    </div>
  </div>
</nav>


<!-- LOGIN SECTION -->
<section class="login-wrapper">
  <div class="container-fluid h-100">
    <div class="row h-100">

      <!-- LEFT: FORM -->
      <div class="col-lg-6 d-flex align-items-center justify-content-center">
        <div class="login-card">

          <h1 class="login-title">
            Masuk Ke <span>TERALIS</span>
          </h1>

          <p class="login-desc">
            Gunakan akun SSO Telkom University Anda untuk mulai
            melakukan reservasi ruangan.
          </p>

          <!-- FORM -->
          <form id="loginForm">

            <div class="mb-4">
              <label class="form-label">Email</label>
              <input
                type="email"
                id="email"
                name="email"
                class="form-control"
                placeholder="Masukkan Email"
                required
              >
            </div>

            <div class="mb-3">
              <label class="form-label">Password</label>
              <input
                type="password"
                id="password"
                name="password"
                class="form-control"
                placeholder="••••••••"
                required
              >
            </div>

            <div class="d-flex justify-content-between align-items-center mb-4">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="remember">
                <label class="form-check-label" for="remember">
                  Ingat Saya
                </label>
              </div>
              <a href="#" class="forgot-link">Lupa Password</a>
            </div>

            <p id="errorDisplay" class="error-message text-danger"></p>

            <button type="submit" class="btn-login w-100">
              Sign In
            </button>

            <button type="button" class="btn-sso w-100 mt-3" disabled>
              <img src="assets/img/microsoft.png" alt="">
              Sign in dengan Akun Microsoft
            </button>

          </form>

        </div>
      </div>

      <!-- RIGHT: IMAGE -->
      <div class="col-lg-6 login-image d-none d-lg-block"></div>

    </div>
  </div>
</section>

<script>
  document.getElementById('loginForm').addEventListener('submit', async function(e) {
    e.preventDefault(); // Mencegah reload halaman
    
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    const errorDisplay = document.getElementById('errorDisplay');
    
    errorDisplay.textContent = ""; // Reset pesan error

    try {
      // Mengirim request POST dengan format JSON sesuai ekspektasi AuthController
      const response = await fetch('/WebContent/api/auth/login', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({ email: email, password: password })
      });

      const result = await response.json();

      if (response.ok) {
          // SIMPAN DATA KE LOCALSTORAGE
          // so reservation-form.js bisa mengambil nama asli
          localStorage.setItem('userName', result.name);
          localStorage.setItem('userNimNip', result.nimNip);
          localStorage.setItem('userId', result.id);
          localStorage.setItem('role', result.role);

          // REDIRECT BY ROLE
          if (result.role === 'admin') {
              window.location.href = "admin.html";
          } else if (result.role === 'lecturer' || result.role === 'student') {
              window.location.href = "room.html";
          } else {
              window.location.href = "index.html";
          }
      }
    } catch (error) {
        console.error("Fetch error:", error);
        errorDisplay.textContent = "Terjadi kesalahan pada server.";
    }
  });
</script>
<script src="assets/js/session.js"></script>

</body>
</html>
